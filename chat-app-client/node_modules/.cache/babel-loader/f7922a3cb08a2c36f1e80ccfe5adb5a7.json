{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\\\u05E0\\u05E8\\u05D9\\u05D4\\\\Desktop\\\\web-socket-app\\\\chat-app-client\\\\src\\\\chat\\\\Components\\\\AuthContext.js\",\n    _s = $RefreshSig$();\n\nimport { createContext } from \"react\";\nimport { useHistory } from \"react-router\";\nimport { updateTokens } from \"../DAL/api\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst MINUTE = 60;\nlet inMemoryToken = \"\";\nconst AuthContext = /*#__PURE__*/createContext({\n  refreshToken: () => {}\n});\n\nfunction AuthContextProvider({\n  children\n}) {\n  _s();\n\n  const history = useHistory();\n\n  function getRefreshToken(token) {\n    inMemoryToken = token;\n    const decode = jwt.decode(token);\n    setTimeout(async () => {\n      const {\n        accessToken\n      } = await updateTokens(inMemoryToken);\n\n      if (accessToken) {\n        getRefreshToken(accessToken);\n      } else {\n        logoutHandler();\n        history.push('/login');\n      }\n    }, (decode.exp - decode.iat - MINUTE * 3) * 1000);\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n      value: {\n        refreshToken: getRefreshToken\n      },\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 41,\n      columnNumber: 9\n    }, this)\n  }, void 0, false);\n}\n\n_s(AuthContextProvider, \"9cZfZ04734qoCGIctmKX7+sX6eU=\", false, function () {\n  return [useHistory];\n});\n\n_c = AuthContextProvider;\nexport { AuthContext, AuthContextProvider, inMemoryToken };\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthContextProvider\");","map":{"version":3,"sources":["C:/Users/נריה/Desktop/web-socket-app/chat-app-client/src/chat/Components/AuthContext.js"],"names":["createContext","useHistory","updateTokens","MINUTE","inMemoryToken","AuthContext","refreshToken","AuthContextProvider","children","history","getRefreshToken","token","decode","jwt","setTimeout","accessToken","logoutHandler","push","exp","iat"],"mappings":";;;AAAA,SAASA,aAAT,QAA6B,OAA7B;AACA,SAASC,UAAT,QAA0B,cAA1B;AACA,SAAQC,YAAR,QAA2B,YAA3B;;;AAIA,MAAMC,MAAM,GAAG,EAAf;AACA,IAAIC,aAAa,GAAG,EAApB;AAIA,MAAMC,WAAW,gBAAGL,aAAa,CAAC;AAC9BM,EAAAA,YAAY,EAAE,MAAM,CAAE;AADQ,CAAD,CAAjC;;AAMA,SAASC,mBAAT,CAA6B;AAACC,EAAAA;AAAD,CAA7B,EAAwC;AAAA;;AAEpC,QAAMC,OAAO,GAAGR,UAAU,EAA1B;;AAGA,WAASS,eAAT,CAAyBC,KAAzB,EAA+B;AAC3BP,IAAAA,aAAa,GAAGO,KAAhB;AAEA,UAAMC,MAAM,GAAGC,GAAG,CAACD,MAAJ,CAAWD,KAAX,CAAf;AACAG,IAAAA,UAAU,CAAC,YAAY;AACnB,YAAM;AAACC,QAAAA;AAAD,UAAgB,MAAMb,YAAY,CAACE,aAAD,CAAxC;;AACA,UAAGW,WAAH,EAAgB;AACZL,QAAAA,eAAe,CAACK,WAAD,CAAf;AACH,OAFD,MAEO;AACHC,QAAAA,aAAa;AACbP,QAAAA,OAAO,CAACQ,IAAR,CAAa,QAAb;AACH;AAEJ,KATS,EASP,CAACL,MAAM,CAACM,GAAP,GAAaN,MAAM,CAACO,GAApB,GAA0BhB,MAAM,GAAC,CAAlC,IAAqC,IAT9B,CAAV;AAUH;;AAGD,sBAAO;AAAA,2BACH,QAAC,WAAD,CAAa,QAAb;AAAsB,MAAA,KAAK,EAAI;AAACG,QAAAA,YAAY,EAAEI;AAAf,OAA/B;AAAA,gBACKF;AADL;AAAA;AAAA;AAAA;AAAA;AADG,mBAAP;AAKH;;GA3BQD,mB;UAEWN,U;;;KAFXM,mB;AA6BT,SAASF,WAAT,EAAsBE,mBAAtB,EAA2CH,aAA3C","sourcesContent":["import { createContext} from \"react\"; \r\nimport { useHistory} from \"react-router\";\r\nimport {updateTokens} from \"../DAL/api\"\r\n\r\n\r\n\r\nconst MINUTE = 60 \r\nlet inMemoryToken = \"\"\r\n\r\n\r\n\r\nconst AuthContext = createContext({\r\n    refreshToken: () => {}\r\n}); \r\n\r\n\r\n\r\nfunction AuthContextProvider({children}){\r\n\r\n    const history = useHistory()\r\n    \r\n    \r\n    function getRefreshToken(token){\r\n        inMemoryToken = token\r\n\r\n        const decode = jwt.decode(token)\r\n        setTimeout(async () => {\r\n            const {accessToken} = await updateTokens(inMemoryToken)\r\n            if(accessToken) {\r\n                getRefreshToken(accessToken)\r\n            } else {\r\n                logoutHandler()\r\n                history.push('/login')\r\n            }\r\n    \r\n        }, (decode.exp - decode.iat - MINUTE*3)*1000)  \r\n    }\r\n\r\n\r\n    return <>\r\n        <AuthContext.Provider value = {{refreshToken: getRefreshToken}}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    </>\r\n}\r\n\r\nexport  {AuthContext, AuthContextProvider, inMemoryToken}"]},"metadata":{},"sourceType":"module"}